<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Dosen - BimCheck</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes scaleIn {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        
        .animate-slide-in {
            animation: slideIn 0.4s ease-out;
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        .animate-scale-in {
            animation: scaleIn 0.3s ease-out;
        }
        
        .animate-pulse-slow {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-blue {
            background: linear-gradient(135deg, #667eea 0%, #4c6ef5 100%);
        }
        
        .gradient-green {
            background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%);
        }
        
        .gradient-purple {
            background: linear-gradient(135deg, #b197fc 0%, #9775fa 100%);
        }
        
        .gradient-orange {
            background: linear-gradient(135deg, #ff922b 0%, #fd7e14 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        
        .qr-glow {
            box-shadow: 0 0 30px rgba(103, 126, 234, 0.3);
        }
        
        .table-row-hover {
            transition: all 0.2s ease;
        }
        
        .table-row-hover:hover {
            background: linear-gradient(90deg, rgba(103, 126, 234, 0.05) 0%, rgba(103, 126, 234, 0.02) 100%);
            transform: scale(1.01);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100 min-h-screen">
    <!-- Header with Gradient -->
    <header class="gradient-bg text-white shadow-2xl">
        <div class="container mx-auto px-4 py-4 md:py-6">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <div class="flex items-center space-x-3 md:space-x-4 animate-slide-in w-full md:w-auto">
                    <div class="bg-white bg-opacity-20 p-2 md:p-3 rounded-xl backdrop-blur-sm">
                        <svg class="w-8 h-8 md:w-10 md:h-10" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5zm0 18c-4.41 0-8-3.59-8-8V8.5l8-4.5 8 4.5V12c0 4.41-3.59 8-8 8z"/>
                            <path d="M11 7h2v6h-2zm0 8h2v2h-2z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl md:text-3xl font-bold tracking-tight">BimCheck Dashboard</h1>
                        <p class="text-purple-100 text-xs md:text-sm font-medium">Sistem Antrian Bimbingan Digital</p>
                    </div>
                </div>
                <div class="text-center md:text-right animate-slide-in w-full md:w-auto">
                    <div class="bg-white bg-opacity-20 backdrop-blur-sm rounded-xl px-4 md:px-6 py-2 md:py-3 flex items-center justify-between gap-4">
                        <div>
                            <p class="font-bold text-base md:text-lg">Dr. Ahmad Setiawan, M.Kom</p>
                            <p class="text-xs md:text-sm text-purple-100">Kode Dosen: DSN001</p>
                        </div>
                        <button onclick="handleLogout()" class="bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg p-2 transition duration-300 transform hover:scale-110" title="Logout">
                            <svg class="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto px-3 md:px-4 py-4 md:py-8">
        <!-- Stats Cards with Gradient -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6 mb-4 md:mb-8 animate-fade-in">
            <div class="glass-effect rounded-xl md:rounded-2xl shadow-xl p-3 md:p-6 card-hover relative overflow-hidden">
                <div class="absolute top-0 right-0 w-20 h-20 md:w-32 md:h-32 gradient-blue opacity-10 rounded-full -mr-10 md:-mr-16 -mt-10 md:-mt-16"></div>
                <div class="flex flex-col md:flex-row items-start md:items-center justify-between relative z-10">
                    <div class="mb-2 md:mb-0">
                        <p class="text-gray-500 text-xs md:text-sm font-semibold uppercase tracking-wide">Total Antrian</p>
                        <p class="text-2xl md:text-4xl font-bold text-gray-800 mt-1 md:mt-2" id="totalQueue">8</p>
                    </div>
                    <div class="gradient-blue rounded-xl md:rounded-2xl p-2 md:p-4 shadow-lg">
                        <svg class="w-5 h-5 md:w-8 md:h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="glass-effect rounded-xl md:rounded-2xl shadow-xl p-3 md:p-6 card-hover relative overflow-hidden">
                <div class="absolute top-0 right-0 w-20 h-20 md:w-32 md:h-32 gradient-green opacity-10 rounded-full -mr-10 md:-mr-16 -mt-10 md:-mt-16"></div>
                <div class="flex flex-col md:flex-row items-start md:items-center justify-between relative z-10">
                    <div class="mb-2 md:mb-0">
                        <p class="text-gray-500 text-xs md:text-sm font-semibold uppercase tracking-wide">Sedang Bimbingan</p>
                        <p class="text-2xl md:text-4xl font-bold text-green-600 mt-1 md:mt-2" id="inProgress">1</p>
                    </div>
                    <div class="gradient-green rounded-xl md:rounded-2xl p-2 md:p-4 shadow-lg">
                        <svg class="w-5 h-5 md:w-8 md:h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="glass-effect rounded-xl md:rounded-2xl shadow-xl p-3 md:p-6 card-hover relative overflow-hidden">
                <div class="absolute top-0 right-0 w-20 h-20 md:w-32 md:h-32 gradient-purple opacity-10 rounded-full -mr-10 md:-mr-16 -mt-10 md:-mt-16"></div>
                <div class="flex flex-col md:flex-row items-start md:items-center justify-between relative z-10">
                    <div class="mb-2 md:mb-0">
                        <p class="text-gray-500 text-xs md:text-sm font-semibold uppercase tracking-wide">Selesai Hari Ini</p>
                        <p class="text-2xl md:text-4xl font-bold text-purple-600 mt-1 md:mt-2" id="completedToday">5</p>
                    </div>
                    <div class="gradient-purple rounded-xl md:rounded-2xl p-2 md:p-4 shadow-lg">
                        <svg class="w-5 h-5 md:w-8 md:h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="glass-effect rounded-xl md:rounded-2xl shadow-xl p-3 md:p-6 card-hover relative overflow-hidden">
                <div class="absolute top-0 right-0 w-20 h-20 md:w-32 md:h-32 gradient-orange opacity-10 rounded-full -mr-10 md:-mr-16 -mt-10 md:-mt-16"></div>
                <div class="flex flex-col md:flex-row items-start md:items-center justify-between relative z-10">
                    <div class="mb-2 md:mb-0">
                        <p class="text-gray-500 text-xs md:text-sm font-semibold uppercase tracking-wide">Perlu Revisi</p>
                        <p class="text-2xl md:text-4xl font-bold text-orange-600 mt-1 md:mt-2" id="needRevision">3</p>
                    </div>
                    <div class="gradient-orange rounded-xl md:rounded-2xl p-2 md:p-4 shadow-lg">
                        <svg class="w-5 h-5 md:w-8 md:h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons & QR Display -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 mb-4 md:mb-8 animate-fade-in">
            <!-- Action Buttons -->
            <div class="lg:col-span-2 glass-effect rounded-xl md:rounded-2xl shadow-xl p-4 md:p-6">
                <h3 class="text-base md:text-lg font-bold text-gray-800 mb-3 md:mb-4 flex items-center">
                    <span class="bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg p-1.5 md:p-2 mr-2 md:mr-3">
                        <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                    </span>
                    Aksi Cepat
                </h3>
                <div class="flex flex-col sm:flex-row gap-2 md:gap-3">
                    <button onclick="panggilMahasiswa()" class="gradient-blue text-white px-4 md:px-6 py-2.5 md:py-3 rounded-xl font-semibold md:font-bold text-sm md:text-base shadow-lg hover:shadow-xl transition duration-300 transform hover:scale-105 flex items-center justify-center space-x-2">
                        <span>üì¢</span>
                        <span>Panggil Selanjutnya</span>
                    </button>
                    <button onclick="generateNewQR()" class="gradient-purple text-white px-4 md:px-6 py-2.5 md:py-3 rounded-xl font-semibold md:font-bold text-sm md:text-base shadow-lg hover:shadow-xl transition duration-300 transform hover:scale-105 flex items-center justify-center space-x-2">
                        <span>üîÑ</span>
                        <span>Generate QR Baru</span>
                    </button>
                    <button onclick="refreshQueue()" class="bg-white text-gray-700 px-4 md:px-6 py-2.5 md:py-3 rounded-xl font-semibold md:font-bold text-sm md:text-base shadow-lg hover:shadow-xl transition duration-300 transform hover:scale-105 flex items-center justify-center space-x-2 border-2 border-gray-200">
                        <span>üîÑ</span>
                        <span>Refresh</span>
                    </button>
                </div>
            </div>

            <!-- QR Code Display with Enhanced Design -->
            <div class="glass-effect rounded-xl md:rounded-2xl shadow-xl p-4 md:p-6 text-center relative overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-br from-purple-100 to-blue-100 opacity-30"></div>
                <div class="relative z-10">
                    <div class="flex items-center justify-center mb-2 md:mb-3">
                        <div class="bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg md:rounded-xl px-3 md:px-4 py-1.5 md:py-2">
                            <p class="text-xs md:text-sm font-bold uppercase tracking-wider">QR Validasi Kehadiran</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl md:rounded-2xl p-3 md:p-4 shadow-inner mx-auto inline-block qr-glow mb-2 md:mb-3">
                        <div id="qrcode" class="flex justify-center"></div>
                    </div>
                    <div class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg md:rounded-xl p-2 md:p-3 border-2 border-purple-200">
                        <p class="text-xs text-gray-600 font-medium mb-1">Mahasiswa scan QR ini untuk validasi</p>
                        <p id="qrTimer" class="text-xs md:text-sm font-bold text-purple-600">Berlaku: 5:00</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Queue Table with Enhanced Design -->
        <div class="glass-effect rounded-xl md:rounded-2xl shadow-2xl overflow-hidden animate-fade-in">
            <div class="bg-gradient-to-r from-purple-600 to-blue-600 px-4 md:px-6 py-4 md:py-5 text-white">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2 md:space-x-3">
                        <div class="bg-white bg-opacity-20 backdrop-blur-sm rounded-lg md:rounded-xl p-1.5 md:p-2">
                            <svg class="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                        </div>
                        <div>
                            <h2 class="text-lg md:text-2xl font-bold">Daftar Antrian Bimbingan</h2>
                            <p class="text-xs md:text-sm text-purple-100 font-medium hidden sm:block">Kelola antrian dan status bimbingan mahasiswa</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                        <tr>
                            <th class="px-3 md:px-6 py-3 md:py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">No. Antrian</th>
                            <th class="px-3 md:px-6 py-3 md:py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">NPM</th>
                            <th class="px-3 md:px-6 py-3 md:py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider hidden sm:table-cell">Nama Mahasiswa</th>
                            <th class="px-3 md:px-6 py-3 md:py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider hidden md:table-cell">Program Studi</th>
                            <th class="px-3 md:px-6 py-3 md:py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider hidden lg:table-cell">Waktu Booking</th>
                            <th class="px-3 md:px-6 py-3 md:py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Status</th>
                            <th class="px-3 md:px-6 py-3 md:py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="queueTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Data akan diisi oleh JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal Bimbingan with Enhanced Design -->
    <div id="bimbinganModal" class="hidden fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-3 md:p-4">
        <div class="glass-effect rounded-2xl md:rounded-3xl shadow-2xl max-w-2xl w-full animate-scale-in max-h-[90vh] overflow-y-auto">
            <div class="bg-gradient-to-r from-purple-600 to-blue-600 px-4 md:px-6 py-4 md:py-5 text-white rounded-t-2xl md:rounded-t-3xl">
                <div class="flex items-center space-x-2 md:space-x-3">
                    <div class="bg-white bg-opacity-20 backdrop-blur-sm rounded-lg md:rounded-xl p-1.5 md:p-2">
                        <svg class="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl md:text-2xl font-bold">Detail Bimbingan</h3>
                </div>
            </div>
            <div class="px-4 md:px-6 py-4 md:py-6">
                <div class="space-y-4 md:space-y-5">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 md:gap-4">
                        <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl p-3 md:p-4 border border-blue-200">
                            <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-1 md:mb-2">NPM</label>
                            <p id="modalNPM" class="text-gray-900 font-bold text-base md:text-lg">-</p>
                        </div>
                        <div class="bg-gradient-to-br from-purple-50 to-blue-50 rounded-xl p-3 md:p-4 border border-purple-200">
                            <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-1 md:mb-2">Nama</label>
                            <p id="modalNama" class="text-gray-900 font-bold text-base md:text-lg">-</p>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-indigo-50 to-blue-50 rounded-xl p-3 md:p-4 border border-indigo-200">
                        <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-1 md:mb-2">Program Studi</label>
                        <p id="modalProdi" class="text-gray-900 font-semibold text-sm md:text-base">-</p>
                    </div>

                    <div class="bg-white rounded-xl p-3 md:p-4 border-2 border-gray-200">
                        <label class="block text-sm font-bold text-gray-700 mb-3">Status Bimbingan</label>
                        <div class="flex flex-col sm:flex-row gap-3 md:gap-4">
                            <label class="flex-1 cursor-pointer">
                                <input type="radio" name="statusRevisi" value="selesai" class="peer sr-only">
                                <div class="peer-checked:gradient-green peer-checked:text-white peer-checked:border-green-500 border-2 border-gray-200 rounded-xl p-3 md:p-4 text-center transition duration-300 hover:border-green-300">
                                    <span class="text-2xl md:text-3xl block mb-1 md:mb-2">‚úÖ</span>
                                    <span class="font-bold text-sm md:text-base">Selesai</span>
                                    <p class="text-xs mt-1 opacity-70">Tidak Perlu Revisi</p>
                                </div>
                            </label>
                            <label class="flex-1 cursor-pointer">
                                <input type="radio" name="statusRevisi" value="revisi" class="peer sr-only">
                                <div class="peer-checked:gradient-orange peer-checked:text-white peer-checked:border-orange-500 border-2 border-gray-200 rounded-xl p-3 md:p-4 text-center transition duration-300 hover:border-orange-300">
                                    <span class="text-2xl md:text-3xl block mb-1 md:mb-2">‚ö†Ô∏è</span>
                                    <span class="font-bold text-sm md:text-base">Perlu Revisi</span>
                                    <p class="text-xs mt-1 opacity-70">Masih Ada Perbaikan</p>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Catatan Bimbingan</label>
                        <textarea id="catatanBimbingan" rows="4" class="w-full px-3 md:px-4 py-2 md:py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition duration-300 text-sm md:text-base" placeholder="Masukkan catatan hasil bimbingan..."></textarea>
                    </div>

                    <div id="revisiSection" class="hidden">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Catatan Revisi</label>
                        <textarea id="catatanRevisi" rows="3" class="w-full px-3 md:px-4 py-2 md:py-3 border-2 border-orange-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent transition duration-300 text-sm md:text-base" placeholder="Jelaskan bagian yang perlu direvisi..."></textarea>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-col sm:flex-row justify-between items-stretch sm:items-center gap-3 pt-4 border-t-2 border-gray-200">
                        <button onclick="closeModal()" class="flex-1 px-4 md:px-6 py-2.5 md:py-3 border-2 border-gray-300 rounded-xl text-gray-700 font-bold hover:bg-gray-100 transition duration-300 transform hover:scale-105 flex items-center justify-center space-x-2">
                            <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                            <span class="text-sm md:text-base">Batal</span>
                        </button>
                        <button onclick="selesaiBimbingan()" class="flex-1 gradient-green text-white px-4 md:px-6 py-2.5 md:py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transition duration-300 transform hover:scale-105 flex items-center justify-center space-x-2">
                            <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            <span class="text-sm md:text-base">Selesai Bimbingan</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Konfirmasi Logout -->
    <div id="logoutModal" class="hidden fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-3 md:p-4">
        <div class="glass-effect rounded-2xl md:rounded-3xl shadow-2xl max-w-md w-full animate-scale-in">
            <div class="px-4 md:px-6 py-6 md:py-8 text-center">
                <div class="mb-4 md:mb-6">
                    <div class="mx-auto flex items-center justify-center h-16 w-16 md:h-20 md:w-20 rounded-full bg-gradient-to-r from-orange-500 to-red-500 shadow-lg">
                        <svg class="h-10 w-10 md:h-12 md:w-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                    </div>
                </div>
                <h3 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2 md:mb-3">Konfirmasi Logout</h3>
                <p class="text-gray-600 mb-6 md:mb-8 text-base md:text-lg">Apakah Anda yakin ingin keluar dari dashboard?</p>
                <div class="flex flex-col sm:flex-row gap-3">
                    <button onclick="closeLogoutModal()" class="flex-1 px-6 py-3 border-2 border-gray-300 rounded-xl text-gray-700 font-bold hover:bg-gray-100 transition duration-300 transform hover:scale-105">
                        Batal
                    </button>
                    <button onclick="confirmLogout()" class="flex-1 bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transition duration-300 transform hover:scale-105">
                        Ya, Logout
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Scan Success with Enhanced Animation -->
    <div id="scanSuccessModal" class="hidden fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-3 md:p-4">
        <div class="glass-effect rounded-2xl md:rounded-3xl shadow-2xl max-w-md w-full animate-scale-in">
            <div class="px-4 md:px-6 py-6 md:py-8 text-center">
                <div class="mb-4 md:mb-6 animate-bounce">
                    <div class="mx-auto flex items-center justify-center h-16 w-16 md:h-20 md:w-20 rounded-full gradient-green shadow-lg">
                        <svg class="h-10 w-10 md:h-12 md:w-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                </div>
                <h3 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2 md:mb-3">Validasi Berhasil!</h3>
                <p class="text-gray-600 mb-4 md:mb-6 text-base md:text-lg">Mahasiswa <span id="scanMahasiswaName" class="font-bold text-purple-600"></span> telah tervalidasi</p>
                <button onclick="closeScanModal()" class="gradient-green text-white px-6 md:px-8 py-2.5 md:py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transition duration-300 transform hover:scale-105 w-full text-sm md:text-base">
                    OK, Mengerti
                </button>
            </div>
        </div>
    </div>

    <script>
        // Data dummy antrian
        let queueData = [
            { id: 1, no: 'A001', npm: '714240020', nama: 'Samuel Harry Priatno', prodi: 'Teknik Informatika', waktu: '09:00', status: 'dipanggil' },
            { id: 2, no: 'A002', npm: '714240053', nama: 'Muhamad Maulana Febrian', prodi: 'Teknik Informatika', waktu: '09:15', status: 'menunggu' },
            { id: 3, no: 'A003', npm: '714240078', nama: 'Budi Santoso', prodi: 'Sistem Informasi', waktu: '09:30', status: 'menunggu' },
            { id: 4, no: 'A004', npm: '714240089', nama: 'Siti Nurhaliza', prodi: 'Teknik Informatika', waktu: '09:45', status: 'menunggu' },
            { id: 5, no: 'A005', npm: '714240095', nama: 'Andi Pratama', prodi: 'Sistem Informasi', waktu: '10:00', status: 'menunggu' },
            { id: 6, no: 'A006', npm: '714240102', nama: 'Dewi Lestari', prodi: 'Teknik Informatika', waktu: '10:15', status: 'menunggu' },
            { id: 7, no: 'A007', npm: '714240115', nama: 'Rudi Hermawan', prodi: 'Sistem Informasi', waktu: '10:30', status: 'menunggu' },
            { id: 8, no: 'A008', npm: '714240128', nama: 'Maya Sari', prodi: 'Teknik Informatika', waktu: '10:45', status: 'menunggu' }
        ];

        let currentBimbingan = null;
        let qrTimer = null;
        let qrTimeRemaining = 300;
        let currentQRToken = null;

        // Generate QR Code
        function generateQRCode() {
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';
            
            const timestamp = new Date().getTime();
            const randomStr = Math.random().toString(36).substring(2, 15);
            currentQRToken = `BIMCHECK-${timestamp}-${randomStr}`;
            
            // Buat URL yang bisa diakses mahasiswa untuk validasi
            const baseURL = window.location.origin + window.location.pathname.replace(/[^\/]*$/, '');
            const validationURL = `${baseURL}?action=validate&token=${currentQRToken}&dosen=DSN001&timestamp=${timestamp}`;
            
            // Simpan data token untuk validasi
            sessionStorage.setItem('currentToken', JSON.stringify({
                token: currentQRToken,
                dosenId: 'DSN001',
                dosenNama: 'Dr. Ahmad Setiawan, M.Kom',
                timestamp: timestamp,
                validUntil: timestamp + (5 * 60 * 1000)
            }));

            new QRCode(qrContainer, {
                text: validationURL,
                width: 180,
                height: 180,
                colorDark: "#5b21b6",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });

            qrTimeRemaining = 300;
            startQRTimer();
        }

        // Timer QR Code
        function startQRTimer() {
            if (qrTimer) clearInterval(qrTimer);
            
            qrTimer = setInterval(() => {
                qrTimeRemaining--;
                
                const minutes = Math.floor(qrTimeRemaining / 60);
                const seconds = qrTimeRemaining % 60;
                const timerDisplay = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                document.getElementById('qrTimer').textContent = `Berlaku: ${timerDisplay}`;
                
                if (qrTimeRemaining <= 0) {
                    clearInterval(qrTimer);
                    document.getElementById('qrTimer').textContent = '‚ö†Ô∏è QR Expired - Generate Baru';
                    document.getElementById('qrTimer').classList.add('text-red-600');
                    document.getElementById('qrTimer').classList.remove('text-purple-600');
                } else if (qrTimeRemaining <= 60) {
                    document.getElementById('qrTimer').classList.add('text-red-600', 'animate-pulse-slow');
                    document.getElementById('qrTimer').classList.remove('text-purple-600');
                }
            }, 1000);
        }

        // Generate QR baru
        function generateNewQR() {
            document.getElementById('qrTimer').classList.remove('text-red-600', 'animate-pulse-slow');
            document.getElementById('qrTimer').classList.add('text-purple-600');
            generateQRCode();
        }

        // Simulasi scan QR
        function simulateScan(mahasiswaId) {
            const mahasiswa = queueData.find(q => q.id === mahasiswaId);
            if (mahasiswa && mahasiswa.status === 'dipanggil') {
                if (qrTimeRemaining > 0 && currentQRToken) {
                    mahasiswa.validated = true;
                    document.getElementById('scanMahasiswaName').textContent = mahasiswa.nama;
                    document.getElementById('scanSuccessModal').classList.remove('hidden');
                    renderTable();
                } else {
                    alert('‚ö†Ô∏è QR Code sudah expired! Generate QR baru.');
                }
            } else {
                alert('‚ö†Ô∏è Mahasiswa belum dipanggil atau tidak ditemukan!');
            }
        }

        // Close scan modal
        function closeScanModal() {
            document.getElementById('scanSuccessModal').classList.add('hidden');
        }

        // Render tabel
        function renderTable() {
            const tbody = document.getElementById('queueTableBody');
            tbody.innerHTML = '';

            queueData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.className = 'table-row-hover';
                row.style.animationDelay = `${index * 0.05}s`;

                let statusBadge = '';
                let actionButton = '';

                switch(item.status) {
                    case 'menunggu':
                        statusBadge = '<span class="px-2 md:px-4 py-1 md:py-2 inline-flex text-xs leading-5 font-bold rounded-lg md:rounded-xl bg-yellow-100 text-yellow-800 border-2 border-yellow-300">‚è≥ Menunggu</span>';
                        actionButton = `<button onclick="panggilMahasiswaById(${item.id})" class="gradient-blue text-white px-3 md:px-5 py-1.5 md:py-2 rounded-lg md:rounded-xl text-xs md:text-sm font-bold shadow-lg hover:shadow-xl transition duration-300 transform hover:scale-105">üì¢ Panggil</button>`;
                        break;
                    case 'dipanggil':
                        const validatedBadge = item.validated ? '<span class="ml-1 md:ml-2 text-green-600 text-xs font-bold">‚úì</span>' : '<span class="ml-1 md:ml-2 text-gray-400 text-xs font-bold">‚ßó</span>';
                        statusBadge = '<span class="px-2 md:px-4 py-1 md:py-2 inline-flex text-xs leading-5 font-bold rounded-lg md:rounded-xl bg-green-100 text-green-800 border-2 border-green-300">üü¢ Bimbingan' + validatedBadge + '</span>';
                        if (item.validated) {
                            actionButton = `<button onclick="openBimbinganModal(${item.id})" class="gradient-green text-white px-3 md:px-5 py-1.5 md:py-2 rounded-lg md:rounded-xl text-xs md:text-sm font-bold shadow-lg hover:shadow-xl transition duration-300 transform hover:scale-105">‚úÖ Selesai</button>`;
                        } else {
                            actionButton = `<button onclick="simulateScan(${item.id})" class="gradient-purple text-white px-3 md:px-5 py-1.5 md:py-2 rounded-lg md:rounded-xl text-xs md:text-sm font-bold shadow-lg hover:shadow-xl transition duration-300 transform hover:scale-105">üì∑ Scan</button>`;
                        }
                        break;
                    case 'selesai':
                        statusBadge = '<span class="px-2 md:px-4 py-1 md:py-2 inline-flex text-xs leading-5 font-bold rounded-lg md:rounded-xl bg-gray-100 text-gray-700 border-2 border-gray-300">‚úì Selesai</span>';
                        actionButton = '<span class="text-gray-400 text-xs md:text-sm font-semibold">-</span>';
                        break;
                    case 'revisi':
                        statusBadge = '<span class="px-2 md:px-4 py-1 md:py-2 inline-flex text-xs leading-5 font-bold rounded-lg md:rounded-xl bg-orange-100 text-orange-800 border-2 border-orange-300">‚ö†Ô∏è Revisi</span>';
                        actionButton = '<span class="text-gray-400 text-xs md:text-sm font-semibold">-</span>';
                        break;
                }

                row.innerHTML = `
                    <td class="px-3 md:px-6 py-4 md:py-5 whitespace-nowrap">
                        <span class="text-xs md:text-sm font-bold text-gray-900 bg-gradient-to-r from-purple-100 to-blue-100 px-2 md:px-3 py-1 rounded-lg">${item.no}</span>
                    </td>
                    <td class="px-3 md:px-6 py-4 md:py-5 whitespace-nowrap text-xs md:text-sm text-gray-900 font-semibold">${item.npm}</td>
                    <td class="px-3 md:px-6 py-4 md:py-5 whitespace-nowrap text-xs md:text-sm font-bold text-gray-900 hidden sm:table-cell">${item.nama}</td>
                    <td class="px-3 md:px-6 py-4 md:py-5 whitespace-nowrap text-xs md:text-sm text-gray-600 font-medium hidden md:table-cell">${item.prodi}</td>
                    <td class="px-3 md:px-6 py-4 md:py-5 whitespace-nowrap text-xs md:text-sm text-gray-600 font-medium hidden lg:table-cell">${item.waktu}</td>
                    <td class="px-3 md:px-6 py-4 md:py-5 whitespace-nowrap">${statusBadge}</td>
                    <td class="px-3 md:px-6 py-4 md:py-5 whitespace-nowrap text-xs md:text-sm">${actionButton}</td>
                `;

                tbody.appendChild(row);
            });

            updateStats();
        }

        // Update statistik
        function updateStats() {
            const total = queueData.filter(q => q.status !== 'selesai' && q.status !== 'revisi').length;
            const inProgress = queueData.filter(q => q.status === 'dipanggil').length;
            const completed = queueData.filter(q => q.status === 'selesai').length;
            const revision = queueData.filter(q => q.status === 'revisi').length;

            document.getElementById('totalQueue').textContent = total;
            document.getElementById('inProgress').textContent = inProgress;
            document.getElementById('completedToday').textContent = completed;
            document.getElementById('needRevision').textContent = revision;
        }

        // Panggil mahasiswa selanjutnya
        function panggilMahasiswa() {
            const nextStudent = queueData.find(q => q.status === 'menunggu');
            if (nextStudent) {
                nextStudent.status = 'dipanggil';
                alert(`‚úÖ Mahasiswa ${nextStudent.nama} (${nextStudent.no}) dipanggil!`);
                renderTable();
            } else {
                alert('‚ö†Ô∏è Tidak ada mahasiswa dalam antrian.');
            }
        }

        // Panggil mahasiswa by ID
        function panggilMahasiswaById(id) {
            const student = queueData.find(q => q.id === id);
            if (student) {
                student.status = 'dipanggil';
                alert(`‚úÖ Mahasiswa ${student.nama} (${student.no}) dipanggil!`);
                renderTable();
            }
        }

        // Open modal bimbingan
        function openBimbinganModal(id) {
            currentBimbingan = queueData.find(q => q.id === id);
            if (currentBimbingan) {
                document.getElementById('modalNPM').textContent = currentBimbingan.npm;
                document.getElementById('modalNama').textContent = currentBimbingan.nama;
                document.getElementById('modalProdi').textContent = currentBimbingan.prodi;
                document.getElementById('catatanBimbingan').value = '';
                document.getElementById('catatanRevisi').value = '';
                document.getElementById('bimbinganModal').classList.remove('hidden');
            }
        }

        // Close modal
        function closeModal() {
            document.getElementById('bimbinganModal').classList.add('hidden');
            currentBimbingan = null;
        }

        // Toggle revisi section
        document.querySelectorAll('input[name="statusRevisi"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const revisiSection = document.getElementById('revisiSection');
                if (this.value === 'revisi') {
                    revisiSection.classList.remove('hidden');
                } else {
                    revisiSection.classList.add('hidden');
                }
            });
        });

        // Selesai bimbingan
        function selesaiBimbingan() {
            const statusRevisi = document.querySelector('input[name="statusRevisi"]:checked');
            const catatan = document.getElementById('catatanBimbingan').value;
            const catatanRevisi = document.getElementById('catatanRevisi').value;

            if (!statusRevisi) {
                alert('‚ö†Ô∏è Pilih status bimbingan terlebih dahulu!');
                return;
            }

            if (!catatan.trim()) {
                alert('‚ö†Ô∏è Masukkan catatan bimbingan!');
                return;
            }

            if (statusRevisi.value === 'revisi' && !catatanRevisi.trim()) {
                alert('‚ö†Ô∏è Masukkan catatan revisi!');
                return;
            }

            if (currentBimbingan) {
                currentBimbingan.status = statusRevisi.value;
                alert(`‚úÖ Bimbingan selesai! Status: ${statusRevisi.value === 'selesai' ? 'Selesai' : 'Perlu Revisi'}`);
                closeModal();
                renderTable();
            }
        }

        // Refresh queue
        function refreshQueue() {
            renderTable();
            alert('‚úÖ Antrian berhasil diperbarui!');
        }

        // Initial render
        renderTable();
        generateQRCode();
        
        // Check jika ada parameter validasi dari scan QR
        window.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const action = urlParams.get('action');
            const token = urlParams.get('token');
            const dosenId = urlParams.get('dosen');
            const timestamp = urlParams.get('timestamp');
            
            if (action === 'validate' && token && dosenId && timestamp) {
                validateQRScan(token, dosenId, timestamp);
            }
        });
        
        // Fungsi validasi scan QR
        function validateQRScan(scannedToken, dosenId, timestamp) {
            try {
                const storedData = sessionStorage.getItem('currentToken');
                
                if (!storedData) {
                    showValidationResult(false, 'Token tidak ditemukan. QR mungkin sudah expired atau belum di-generate.');
                    return;
                }
                
                const tokenData = JSON.parse(storedData);
                const currentTime = new Date().getTime();
                
                // Validasi token
                if (tokenData.token !== scannedToken) {
                    showValidationResult(false, 'Token tidak valid!');
                    return;
                }
                
                // Validasi waktu expired
                if (currentTime > tokenData.validUntil) {
                    showValidationResult(false, 'QR Code sudah expired! Mohon minta dosen untuk generate QR baru.');
                    return;
                }
                
                // Validasi dosen
                if (tokenData.dosenId !== dosenId) {
                    showValidationResult(false, 'QR Code bukan untuk dosen ini!');
                    return;
                }
                
                // Cari mahasiswa yang sedang dipanggil
                const calledStudent = queueData.find(q => q.status === 'dipanggil' && !q.validated);
                
                if (!calledStudent) {
                    showValidationResult(false, 'Tidak ada mahasiswa yang sedang dipanggil atau sudah tervalidasi.');
                    return;
                }
                
                // Validasi berhasil
                calledStudent.validated = true;
                renderTable();
                showValidationResult(true, `Validasi berhasil untuk ${calledStudent.nama} (${calledStudent.npm})`);
                
                // Hapus parameter URL
                window.history.replaceState({}, document.title, window.location.pathname);
                
            } catch (error) {
                showValidationResult(false, 'Terjadi kesalahan saat validasi: ' + error.message);
            }
        }
        
        // Tampilkan hasil validasi
        function showValidationResult(success, message) {
            const modalHTML = `
                <div id="validationResultModal" class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                    <div class="glass-effect rounded-3xl shadow-2xl max-w-md w-full animate-scale-in">
                        <div class="px-6 py-8 text-center">
                            <div class="mb-6 ${success ? 'animate-bounce' : ''}">
                                <div class="mx-auto flex items-center justify-center h-20 w-20 rounded-full ${success ? 'gradient-green' : 'gradient-orange'} shadow-lg">
                                    ${success ? 
                                        '<svg class="h-12 w-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>' :
                                        '<svg class="h-12 w-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12"></path></svg>'
                                    }
                                </div>
                            </div>
                            <h3 class="text-3xl font-bold text-gray-800 mb-3">${success ? 'Validasi Berhasil!' : 'Validasi Gagal!'}</h3>
                            <p class="text-gray-600 mb-6 text-lg">${message}</p>
                            <button onclick="closeValidationModal()" class="${success ? 'gradient-green' : 'gradient-orange'} text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transition duration-300 transform hover:scale-105 w-full">
                                OK, Mengerti
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }
        
        // Close validation modal
        function closeValidationModal() {
            const modal = document.getElementById('validationResultModal');
            if (modal) {
                modal.remove();
            }
        }

        // Handle Logout
        function handleLogout() {
            document.getElementById('logoutModal').classList.remove('hidden');
        }

        // Close Logout Modal
        function closeLogoutModal() {
            document.getElementById('logoutModal').classList.add('hidden');
        }

        // Confirm Logout
        function confirmLogout() {
            // Clear session data
            sessionStorage.clear();
            localStorage.clear();
            
            // Redirect to login page
            alert('‚úÖ Logout berhasil! Terima kasih telah menggunakan BimCheck.');
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>